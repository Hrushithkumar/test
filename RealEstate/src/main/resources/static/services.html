<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Main Page - Iron Pillar Engineering and Construction</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <link href="css/HeaderFooter.css" rel="stylesheet" />
    <style>
      body {
        font-family: "Montserrat", sans-serif;
        background-color: #f4f7f6;
        color: #333;
        line-height: 1.6;
        margin: 0;
        padding-top: 80px;
      }
      header {
        background-color: #2c3e50;
        padding: 10px 20px;
        position: fixed;
        width: 100%;
        top: 0;
        z-index: 1000;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      header .logo {
        display: flex;
        align-items: center;
        color: #fff;
        font-size: 1.5em;
        font-weight: bold;
      }
      header .logo img {
        max-width: 50px;
        height: auto;
        margin-right: 10px;
      }
      header nav ul {
        list-style: none;
        display: flex;
        margin: 0;
        padding: 0;
      }
      header nav ul li {
        margin: 0 15px;
        position: relative;
      }
      header nav ul li a {
        color: #fff;
        text-decoration: none;
        font-weight: bold;
        font-size: 1em;
        transition: color 0.3s;
      }
      header nav ul li a:hover {
        color: #f39c12;
      }
      header nav ul li ul {
        display: none;
        position: absolute;
        top: 100%;
        left: 0;
        background: #2c3e50;
        padding: 0;
        margin: 0;
        list-style: none;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }
      header nav ul li:hover ul {
        display: block;
      }
      header nav ul li ul li {
        margin: 0;
      }
      header nav ul li ul li a {
        padding: 10px 15px;
        display: block;
        color: #fff;
      }
      header nav ul li ul li a:hover {
        background: #34495e;
      }
      .hero {
        background: url("images/img2.jpg") no-repeat center center/cover;
        color: white;
        height: 400px;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        text-align: center;
        border-bottom: 10px solid #2c3e50;
        padding: 20px;
      }
      .hero .hero-content {
        background-color: rgba(44, 62, 80, 0.8);
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        transform: perspective(500px) rotateX(10deg) translateZ(50px);
      }
      .hero h1 {
        font-size: 3.5em;
        margin-bottom: 15px;
        text-shadow: 3px 3px 5px rgba(0, 0, 0, 0.3);
      }
      .hero p {
        font-size: 1.3em;
        margin-bottom: 15px;
        text-shadow: 3px 3px 5px rgba(0, 0, 0, 0.3);
      }
      .dynamic-ads {
        background-color: #ecf0f1;
        padding: 40px 0;
      }
      .ad-item {
        background: #fff;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        border-radius: 10px;
        overflow: hidden;
        transition: transform 0.3s;
        text-align: center;
        position: relative;
      }
      .ad-item:hover {
        transform: translateY(-10px);
      }
      .ad-item img {
        width: 100%;
        height: auto;
        border-bottom: 2px solid #2c3e50;
      }
      .ad-item h3 {
        margin: 10px 0;
        font-size: 1.5em;
      }
      .ad-item p {
        color: #555;
        padding: 0 15px 15px;
      }
      .ad-item .ad-popup {
        display: none;
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(44, 62, 80, 0.9);
        color: white;
        padding: 20px;
        box-sizing: border-box;
        border-radius: 10px;
        opacity: 0;
        transition: opacity 0.3s;
      }
      .ad-item:hover .ad-popup {
        display: block;
        opacity: 1;
      }
      .about {
        padding: 40px 0;
        text-align: center;
      }
      .about h2 {
        font-size: 2.2em;
        margin-bottom: 20px;
      }
      .about p {
        font-size: 1.1em;
        color: #555;
        max-width: 800px;
        margin: 0 auto;
      }
      .contact-section,
      .quote-section {
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 40px 0;
        text-align: left;
        position: relative;
      }
      .contact-section img,
      .quote-section img {
        width: 400px;
        height: 700px;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        margin-right: 20px;
      }
      .contact-section form,
      .quote-section form {
        flex: 1;
        max-width: 600px;
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        transform: perspective(500px) rotateY(10deg) translateZ(50px);
        transition: transform 0.3s;
      }
      .contact-section:hover form,
      .quote-section:hover form {
        transform: perspective(500px) rotateY(0deg) translateZ(0);
      }
      footer {
        background-color: #2c3e50;
        color: white;
        text-align: center;
        padding: 15px 0;
        position: relative;
        margin-top: 50px;
        border-top: 10px solid #34495e;
      }
      footer .container {
        display: flex;
        justify-content: space-between;
        flex-wrap: wrap;
      }
      footer h5 {
        font-size: 1.2em;
      }
      footer ul {
        list-style: none;
        padding: 0;
      }
      footer ul li {
        margin-bottom: 10px;
      }
      footer ul li a {
        color: white;
        text-decoration: none;
        transition: color 0.3s;
      }
      footer ul li a:hover {
        color: #f39c12;
      }
      .footer .social-icons {
        display: flex;
        gap: 10px;
      }
      .footer .social-icons a {
        color: #fff;
        font-size: 1.4rem;
        transition: color 0.3s;
      }
      .footer .social-icons a:hover {
        color: #f39c12;
      }
      footer p {
        font-size: 0.9em;
      }
      @media (max-width: 768px) {
        header {
          flex-direction: column;
          align-items: flex-start;
        }
        header nav ul {
          flex-direction: column;
          width: 100%;
          margin-top: 10px;
        }
        header nav ul li {
          margin: 5px 0;
        }
        .footer .container {
          flex-direction: column;
          align-items: center;
        }
        .footer .social-icons {
          margin-top: 10px;
        }
      }
    </style>
    <script src="js/auth.js"></script>
  </head>
  <body>
    <div id="header-container"></div>

    <section class="hero">
      <div class="hero-content">
        <h1>Welcome to Iron Pillar Engineering and Construction</h1>
        <p>Building the future with innovation and excellence.</p>
      </div>
    </section>

    <section class="dynamic-ads">
      <div class="container">
        <h2>Our Projects</h2>

        <label for="project-filter"></label>
        <select id="project-filter" class="form-select mb-4"></select>
        <div class="row" id="listings">
          <!-- Listings will be dynamically added here -->
        </div>
      </div>
    </section>

    <section class="dynamic-ads">
      <div class="container">
        <h2>Homes for Sale</h2>
        <select id="home-filter" class="form-select mb-4"></select>
        <div class="row" id="home-listings">
          <!-- Home listings will be dynamically added here -->
        </div>
      </div>
    </section>

    <section class="about">
      <div class="container">
        <h2>About Us</h2>
        <p>
          At Iron Pillar Engineering and Construction, we are dedicated to
          delivering top-notch construction solutions tailored to meet the
          unique needs of our clients. Our team of experts is committed to
          ensuring the highest standards of quality and excellence in every
          project we undertake.
        </p>
      </div>
    </section>

    <section class="contact-section">
      <div class="container d-flex">
        <img src="/images/contactus.jpg" alt="Contact Us Image" />
        <form id="contact-form" method="POST" action="/employee/contacts">
          <h2>Contact Us</h2>
          <div class="mb-3">
            <label for="contact-name" class="form-label">Name:</label>
            <input
              type="text"
              class="form-control"
              id="contact-name"
              name="contact-name"
              required
            />
          </div>
          <div class="mb-3">
            <label for="contact-email" class="form-label">Email:</label>
            <input
              type="email"
              class="form-control"
              id="contact-email"
              name="contact-email"
              required
            />
          </div>
          <div class="mb-3">
            <label for="contact-message" class="form-label">Message:</label>
            <textarea
              class="form-control"
              id="contact-message"
              name="contact-message"
              rows="4"
              required
            ></textarea>
          </div>
          <button type="submit" class="btn btn-primary">Submit</button>
        </form>
      </div>
    </section>

    <section class="quote-section">
      <div class="container d-flex">
        <img src="/images/getquote.jpg" alt="Get a Quote Image" />
        <form id="quote-form">
          <h2>Get a Quote</h2>
          <div class="mb-3">
            <label for="quote-name" class="form-label">Name:</label>
            <input
              type="text"
              class="form-control"
              id="quote-name"
              name="quote-name"
              required
            />
          </div>
          <div class="mb-3">
            <label for="quote-email" class="form-label">Email:</label>
            <input
              type="email"
              class="form-control"
              id="quote-email"
              name="quote-email"
              required
            />
          </div>
          <div class="mb-3">
            <label for="quote-phone" class="form-label">Phone:</label>
            <input
              type="tel"
              class="form-control"
              id="quote-phone"
              name="quote-phone"
              required
            />
          </div>
          <div class="mb-3">
            <label for="quote-location" class="form-label">Location:</label>
            <input
              type="text"
              class="form-control"
              id="quote-location"
              name="quote-location"
              required
            />
          </div>
          <div class="mb-3">
            <label for="quote-service" class="form-label">Service:</label>
            <select
              id="quote-service"
              class="form-control"
              name="quote-service"
              required
            >
              <option value="" disabled selected>Select a service</option>
              <option value="new-home-construction">
                New Home Construction
              </option>
              <option value="custom-home-building">Custom Home Building</option>
              <option value="pre-designed-home-plans">
                Pre-Designed Home Plans
              </option>
              <option value="energy-efficient-homes">
                Energy-Efficient Homes
              </option>
              <option value="luxury-home-construction">
                Luxury Home Construction
              </option>
              <option value="home-renovation">
                Home Renovations and Flipping
              </option>
              <option value="kitchen-remodeling">Kitchen Remodeling</option>
              <option value="bathroom-remodeling">Bathroom Remodeling</option>
              <option value="whole-house-renovations">
                Whole House Renovations
              </option>
              <option value="basement-finishing">Basement Finishing</option>
              <option value="attic-conversions">Attic Conversions</option>
              <option value="exterior-landscaping">
                Exterior and Landscaping Services
              </option>
              <option value="exterior-home-remodeling">
                Exterior Home Remodeling
              </option>
              <option value="roofing-and-siding">Roofing and Siding</option>
              <option value="deck-patio-construction">
                Deck and Patio Construction
              </option>
              <option value="landscaping-lawn-care">
                Landscaping and Lawn Care
              </option>
              <option value="home-inspection">
                Home Inspection and Consulting
              </option>
              <option value="pre-purchase-inspections">
                Pre-Purchase Home Inspections
              </option>
              <option value="home-energy-audits">Home Energy Audits</option>
              <option value="real-estate-consulting">
                Real Estate Consulting
              </option>
              <option value="property-management">Property Management</option>
              <option value="special-projects">Special Projects</option>
              <option value="historical-restoration">
                Historical Home Restoration
              </option>
              <option value="green-building">
                Green Building and Sustainable Practices
              </option>
              <option value="smart-home-integration">
                Smart Home Integration
              </option>
              <option value="custom-furniture">
                Custom Furniture and Built-Ins
              </option>
            </select>
          </div>
          <div class="mb-3">
            <label for="quote-message" class="form-label">Message:</label>
            <textarea
              class="form-control"
              id="quote-message"
              name="quote-message"
              rows="4"
              required
            ></textarea>
          </div>
          <button type="submit" class="btn btn-primary">Submit</button>
        </form>
      </div>
    </section>

    <div id="footer-container"></div>


    <script>
      fetch("Header.html")
        .then((response) => response.text())
        .then((html) => {
          document.getElementById("header-container").innerHTML = html;
        })
        .catch((error) => console.error("Error fetching header:", error));

      fetch("Footer.html")
              .then((response) => response.text())
              .then((html) => {
                document.getElementById("footer-container").innerHTML = html;
              })
              .catch((error) => console.error("Error fetching footer:", error));

      const token = localStorage.getItem("token");
      document.addEventListener("DOMContentLoaded", () => {
        fetchCategories();
        fetchListings();
        fetchHomeListings();
        fetchHomeCategories();

        document
          .getElementById("contact-form")
          .addEventListener("submit", handleContactFormSubmit);
        document
          .getElementById("quote-form")
          .addEventListener("submit", handleQuoteFormSubmit);
        document
          .getElementById("project-filter")
          .addEventListener("change", filterProjects);
        document
          .getElementById("home-filter")
          .addEventListener("change", filterHomes);
      });

      function fetchCategories() {
        if (token) {
          fetchWithAuth("/projects/categories")
            .then((response) => response.json())
            .then((categories) => {
              const filterSelect = document.getElementById("project-filter");
              filterSelect.innerHTML =
                '<option value="all">All Projects</option>';

              categories.forEach((category) => {
                const option = document.createElement("option");
                option.value = category.toLowerCase().replace(/\s+/g, "-"); // Convert to lowercase and replace spaces with hyphens
                option.textContent = category;
                filterSelect.appendChild(option);
              });
            })
            .catch((error) =>
              console.error("Error fetching project categories:", error)
            );
        } else {
          alert("Session expired, please login");
        }
      }

      function fetchHomeCategories() {
        fetchWithAuth("/homes/categories")
          .then((response) => response.json())
          .then((categories) => {
            const filterSelect = document.getElementById("home-filter");
            filterSelect.innerHTML = '<option value="all">All Homes</option>';

            categories.forEach((category) => {
              const option = document.createElement("option");
              option.value = category.toLowerCase().replace(/\s+/g, "-"); // Convert to lowercase and replace spaces with hyphens
              option.textContent = category;
              filterSelect.appendChild(option);
            });
          })
          .catch((error) =>
            console.error("Error fetching home categories:", error)
          );
      }

      function fetchListings() {
        fetchWithAuth("/projects/view")
          .then((response) => response.json())
          .then((listings) => {
            const listingsContainer = document.getElementById("listings");
            listingsContainer.innerHTML = "";

            if (listings.length === 0) {
              listingsContainer.innerHTML =
                '<p class="col-12 text-center">No projects to display.</p>';
            } else {
              listings.forEach((listing) => {
                const listingHTML = `
                    <div class="col-md-4 mb-3">
                        <div class="ad-item">
                            <img src="/uploads/${listing.image}" alt="${listing.title}">
                            <h3>${listing.title}</h3>
                            <p>${listing.description}</p>
                            <div class="ad-popup">
                                <p>Type: ${listing.category}</p>
                            </div>
                        </div>
                    </div>
                `;
                listingsContainer.innerHTML += listingHTML;
              });

              filterProjects(); // Apply filter after fetching listings
            }
          })
          .catch((error) => console.error("Error fetching listings:", error));
      }

      function fetchHomeListings() {
        fetchWithAuth("/homes/view")
          .then((response) => response.json())
          .then((homeListings) => {
            const homeListingsContainer =
              document.getElementById("home-listings");

            homeListingsContainer.innerHTML = "";

            if (homeListings.length === 0) {
              homeListingsContainer.innerHTML =
                '<p class="col-12 text-center">No homes to display.</p>';
            } else {
              homeListings.forEach((homeListing) => {
                const listingHTML = `
                  <div class="col-md-4 mb-3">
                      <div class="ad-item">
                          <img src="/uploads/${homeListing.image}" alt="${homeListing.title}">
                          <h3>${homeListing.title}</h3>
                          <p>${homeListing.description}</p>
                          <div class="ad-popup">
                              <p>Type: ${homeListing.category}</p>
                          </div>
                      </div>
                  </div>
              `;
                homeListingsContainer.innerHTML += listingHTML;
              });
              filterHomes(); // Apply filter after fetching homes
            }
          })
          .catch((error) => console.error("Error fetching listings:", error));
      }

      function filterProjects() {
        const filter = document.getElementById("project-filter").value;
        const listings = document.querySelectorAll("#listings .col-md-4");

        let projectsFound = false;

        listings.forEach((listing) => {
          const type = listing
            .querySelector(".ad-popup p")
            .textContent.split(":")[1]
            .trim()
            .toLowerCase()
            .replace(/\s+/g, "-");

          if (filter === "all" || type === filter) {
            listing.style.display = "block";
            projectsFound = true;
          } else {
            listing.style.display = "none";
          }
        });

        const listingsContainer = document.getElementById("listings");
        const noProjectsMessage = document.getElementById(
          "no-projects-message"
        );

        if (!projectsFound && filter !== "all") {
          // Add the message only if no projects found for the selected filter
          if (!noProjectsMessage) {
            const message = document.createElement("p");
            message.id = "no-projects-message";
            message.className = "col-12 text-center";
            message.textContent = "No projects matching the selected filter.";
            listingsContainer.appendChild(message);
          }
        } else {
          // Remove the message if projects are found or if "all" filter is selected
          if (noProjectsMessage) {
            noProjectsMessage.remove();
          }
        }
      }

      function filterHomes() {
        const filter = document.getElementById("home-filter").value;
        const homeListings = document.querySelectorAll(
          "#home-listings .ad-item"
        );

        let homesFound = false;

        homeListings.forEach((homeListing) => {
          const type = homeListing
            .querySelector(".ad-popup p")
            .textContent.split(":")[1]
            .trim();
          if (filter === "all" || type === filter) {
            homeListing.style.display = "block";
          } else {
            homeListing.style.display = "none";
          }
        });

        const homesListingsContainer = document.getElementById("home-listings");
        const noHomesMessage = document.getElementById("no-homes-message");

        if (!homesFound && filter !== "all") {
          // Add the message only if no projects found for the selected filter
          if (!noHomesMessage) {
            const message = document.createElement("p");
            message.id = "no-homes-message";
            message.className = "col-12 text-center";
            message.textContent = "No homes matching the selected filter.";
            homesListingsContainer.appendChild(message);
          }
        } else {
          // Remove the message if homes are found or if "all" filter is selected
          if (noHomesMessage) {
            noHomesMessage.remove();
          }
        }
      }

      function handleContactFormSubmit(event) {
        event.preventDefault();
        // const formData = new FormData(event.target);
        // const formDataObject = Object.fromEntries(formData.entries());

        const name = event.target["contact-name"].value;
        const email = event.target["contact-email"].value;
        const message = event.target["contact-message"].value;

        if (!name || !email || !message) {
          alert("Please fill out all fields.");
          return;
        }

        fetchWithAuth("/employee/contacts", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
                    name,
                    email,
                    message
          }),
        })
          .then((response) => {
            if (response.ok) {
              alert("Contact form submitted successfully");
              event.target.reset();
            } else {
              alert("Failed to submit contact form");
            }
          })
          .catch((error) =>
            console.error("Error submitting contact form:", error)
          );
      }

      function handleQuoteFormSubmit(event) {
        event.preventDefault();
        const name = event.target["quote-name"].value;
        const email = event.target["quote-email"].value;
        const phone = event.target["quote-phone"].value;
        const location = event.target["quote-location"].value;
        const service = event.target["quote-service"].value;
        const message = event.target["quote-message"].value;

        if (!name || !email || !location || !service || !phone || !message) {
          alert("Please fill out all fields.");
          return;
        }

        fetchWithAuth("/quotes", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            name,
            email,
            phone,
            location,
            service,
            message,
          }),
        })
          .then((response) => {
            if (response.ok) {
              alert("Quote submitted successfully");
              event.target.reset();
            } else {
              alert("Failed to submit quote");
            }
          })
          .catch((error) => console.error("Error submitting quote:", error));
      }

      function logout() {
        // Add logout logic here
        localStorage.removeItem("token");

        // Redirect to /sample.html
        window.location.href = "/";
      }
    </script>
  </body>
</html>
