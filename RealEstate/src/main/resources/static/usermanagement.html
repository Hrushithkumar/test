<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>User and Employee Management System</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <link href="css/HeaderFooter.css" rel="stylesheet" />

    <style>
      body {
        font-family: "Montserrat", sans-serif;
        background-color: #f4f7f6;
        color: #333;
        margin: 0;
        padding-top: 80px;
        display: flex;
        flex-direction: column;
        min-height: 100vh;
      }
      header {
        background-color: #2c3e50;
        padding: 10px 20px;
        position: fixed;
        width: 100%;
        top: 0;
        z-index: 1000;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      header .logo {
        display: flex;
        align-items: center;
        color: #fff;
        font-size: 1.5em;
        font-weight: bold;
      }
      header .logo img {
        max-width: 50px;
        height: auto;
        margin-right: 10px;
      }
      header nav ul {
        list-style: none;
        display: flex;
        margin: 0;
        padding: 0;
      }
      header nav ul li {
        margin: 0 15px;
        position: relative;
      }
      header nav ul li a {
        color: #fff;
        text-decoration: none;
        font-weight: bold;
        font-size: 1em;
        transition: color 0.3s;
      }
      header nav ul li a:hover {
        color: #f39c12;
      }
      header nav ul li ul {
        display: none;
        position: absolute;
        top: 100%;
        left: 0;
        background: #2c3e50;
        padding: 0;
        margin: 0;
        list-style: none;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }
      header nav ul li:hover ul {
        display: block;
      }
      header nav ul li ul li {
        margin: 0;
      }
      header nav ul li ul li a {
        padding: 10px 15px;
        display: block;
        color: #fff;
      }
      header nav ul li ul li a:hover {
        background: #34495e;
      }
      footer {
        background-color: #2c3e50;
        color: white;
        text-align: center;
        padding: 15px 0;
        position: relative;
        margin-top: auto;
        border-top: 10px solid #34495e;
      }
      footer .container {
        display: flex;
        justify-content: space-between;
        flex-wrap: wrap;
      }
      footer h5 {
        font-size: 1.2em;
      }
      footer ul {
        list-style: none;
        padding: 0;
      }
      footer ul li {
        margin-bottom: 10px;
      }
      footer ul li a {
        color: white;
        text-decoration: none;
        transition: color 0.3s;
      }
      footer ul li a:hover {
        color: #f39c12;
      }
      .footer .social-icons {
        display: flex;
        gap: 10px;
      }
      .footer .social-icons a {
        color: #fff;
        font-size: 1.4rem;
        transition: color 0.3s;
      }
      .footer .social-icons a:hover {
        color: #f39c12;
      }
      footer p {
        font-size: 0.9em;
      }
      .container {
        max-width: 1200px;
        margin: 20px auto;
        padding: 20px;
        background: #fff;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      }
      h2 {
        text-align: center;
        margin-bottom: 20px;
      }
      .form-group {
        margin-bottom: 15px;
      }
      .form-group label {
        font-weight: bold;
      }
      .form-group input,
      .form-group select,
      .form-group textarea {
        width: 100%;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
        box-sizing: border-box;
      }
      .form-group button {
        background-color: #4caf50;
        color: white;
        border: none;
        padding: 10px 20px;
        cursor: pointer;
        border-radius: 5px;
        transition: background-color 0.3s;
        display: block;
        width: 100%;
      }
      .form-group button:hover {
        background-color: #45a049;
      }
      .table {
        width: 100%;
        margin-bottom: 1rem;
        color: #212529;
      }
      .table th,
      .table td {
        padding: 0.75rem;
        vertical-align: top;
        border-top: 1px solid #dee2e6;
      }
      .table thead th {
        vertical-align: bottom;
        border-bottom: 2px solid #dee2e6;
      }
      .table tbody + tbody {
        border-top: 2px solid #dee2e6;
      }
      .table-sm th,
      .table-sm td {
        padding: 0.3rem;
      }
      .table-bordered {
        border: 1px solid #dee2e6;
      }
      .table-bordered th,
      .table-bordered td {
        border: 1px solid #dee2e6;
      }
      .table-bordered thead th,
      .table-bordered thead td {
        border-bottom-width: 2px;
      }
      .form-group.invalid input,
      .form-group.invalid textarea,
      .form-group.invalid select {
        border-color: red;
      }
      .form-group.invalid .error-message {
        color: red;
        font-size: 0.9em;
        display: block;
      }
      @media (max-width: 768px) {
        header {
          flex-direction: column;
          align-items: flex-start;
        }
        header nav ul {
          flex-direction: column;
          width: 100%;
          margin-top: 10px;
        }
        header nav ul li {
          margin: 5px 0;
        }
        .footer .container {
          flex-direction: column;
          align-items: center;
        }
        .footer .social-icons {
          margin-top: 10px;
        }
      }

      @media print {
        body * {
          visibility: hidden;
        }
        .print-container,
        .print-container * {
          visibility: visible;
        }
        .print-container {
          position: absolute;
          left: 0;
          top: 0;
        }
      }
    </style>
    <script src="js/auth.js"></script>
  </head>
  <body>
    <div id="header-container"></div>

    <section class="container mt-5">
      <h2>User Management System</h2>
      <ul class="nav nav-tabs" id="myTab" role="tablist">
        <li class="nav-item" role="presentation">
          <button
            class="nav-link active"
            id="users-tab"
            data-bs-toggle="tab"
            data-bs-target="#users"
            type="button"
            role="tab"
            aria-controls="users"
            aria-selected="true"
          >
            Users
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button
            class="nav-link"
            id="create-user-tab"
            data-bs-toggle="tab"
            data-bs-target="#create-user"
            type="button"
            role="tab"
            aria-controls="create-user"
            aria-selected="false"
          >
            Create User
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button
            class="nav-link"
            id="delete-user-tab"
            data-bs-toggle="tab"
            data-bs-target="#delete-user"
            type="button"
            role="tab"
            aria-controls="delete-user"
            aria-selected="false"
          >
            Delete User
          </button>
        </li>
      </ul>
      <div class="tab-content" id="myTabContent">
        <div
          class="tab-pane fade show active"
          id="users"
          role="tabpanel"
          aria-labelledby="users-tab"
        >
          <div class="mb-3 mt-3">
            <input
              type="text"
              id="searchInput"
              class="form-control"
              placeholder="Search users by name"
            />
          </div>
          <table class="table table-bordered table-striped">
            <thead>
              <tr>
                <th>ID</th>
                <th>Username</th>
                <th>Email</th>
                <th>Phone Number</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="userTableBody">
              <!-- User rows will be dynamically added here -->
            </tbody>
          </table>
        </div>
        <div
          class="tab-pane fade"
          id="create-user"
          role="tabpanel"
          aria-labelledby="create-user-tab"
        >
          <form id="userForm" class="mt-3" novalidate>
            <input type="hidden" id="userId" />
            <div class="form-group">
              <label for="username">Username:</label>
              <input
                type="text"
                id="username"
                name="username"
                required
                aria-required="true"
                aria-describedby="username-error"
              />
              <span class="error-message" id="username-error"></span>
            </div>
            <div class="form-group">
              <label for="email">Email:</label>
              <input
                type="email"
                id="email"
                name="email"
                required
                aria-required="true"
                aria-describedby="email-error"
              />
              <span class="error-message" id="email-error"></span>
            </div>
            <div class="form-group">
              <label for="phoneNumber">Phone Number:</label>
              <input
                type="tel"
                id="phoneNumber"
                name="phoneNumber"
                required
                aria-required="true"
                aria-describedby="phoneNumber-error"
              />
              <span class="error-message" id="phoneNumber-error"></span>
            </div>
            <div class="form-group">
              <label for="password">Password:</label>
              <input
                type="password"
                id="password"
                name="password"
                required
                aria-required="true"
                aria-describedby="password-error"
              />
              <span class="error-message" id="password-error"></span>
            </div>
            <div class="form-group">
              <button type="submit" class="btn btn-primary">Submit</button>
            </div>
          </form>
        </div>
        <div
          class="tab-pane fade"
          id="delete-user"
          role="tabpanel"
          aria-labelledby="delete-user-tab"
        >
          <div class="mb-3 mt-3">
            <input
              type="text"
              id="searchDeleteInput"
              class="form-control"
              placeholder="Search users by name to delete"
            />
          </div>
          <table class="table table-bordered table-striped">
            <thead>
              <tr>
                <th>ID</th>
                <th>Username</th>
                <th>Email</th>
                <th>Phone Number</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="deleteUserTableBody">
              <!-- User rows will be dynamically added here -->
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <section class="container mt-5 print-container">
      <h2>Employee Management System</h2>
      <button class="btn btn-secondary mb-3" onclick="window.print()">
        Print
      </button>
      <ul class="nav nav-tabs" id="employeeTab" role="tablist">
        <li class="nav-item" role="presentation">
          <button
            class="nav-link active"
            id="employees-tab"
            data-bs-toggle="tab"
            data-bs-target="#employees"
            type="button"
            role="tab"
            aria-controls="employees"
            aria-selected="true"
          >
            Employees
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button
            class="nav-link"
            id="create-employee-tab"
            data-bs-toggle="tab"
            data-bs-target="#create-employee"
            type="button"
            role="tab"
            aria-controls="create-employee"
            aria-selected="false"
          >
            Create Employee
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button
            class="nav-link"
            id="delete-employee-tab"
            data-bs-toggle="tab"
            data-bs-target="#delete-employee"
            type="button"
            role="tab"
            aria-controls="delete-employee"
            aria-selected="false"
          >
            Delete Employee
          </button>
        </li>
      </ul>
      <div class="tab-content" id="employeeTabContent">
        <div
          class="tab-pane fade show active"
          id="employees"
          role="tabpanel"
          aria-labelledby="employees-tab"
        >
          <div class="mb-3 mt-3">
            <input
              type="text"
              id="searchEmployeeInput"
              class="form-control"
              placeholder="Search employees by name"
            />
          </div>
          <table class="table table-bordered table-striped">
            <thead>
              <tr>
                <th>ID</th>
                <th>Username</th>
                <th>Email</th>
                <th>Phone Number</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="employeeTableBody">
              <!-- Employee rows will be dynamically added here -->
            </tbody>
          </table>
        </div>
        <div
          class="tab-pane fade"
          id="create-employee"
          role="tabpanel"
          aria-labelledby="create-employee-tab"
        >
          <form id="employeeForm" class="mt-3" novalidate>
            <input type="hidden" id="employeeId" />
            <div class="form-group">
              <label for="employeeUsername">Username:</label>
              <input
                type="text"
                id="employeeUsername"
                name="username"
                required
                aria-required="true"
                aria-describedby="employee-username-error"
              />
              <span class="error-message" id="employee-username-error"></span>
            </div>
            <div class="form-group">
              <label for="employeeEmail">Email:</label>
              <input
                type="email"
                id="employeeEmail"
                name="email"
                required
                aria-required="true"
                aria-describedby="employee-email-error"
              />
              <span class="error-message" id="employee-email-error"></span>
            </div>
            <div class="form-group">
              <label for="employeePhoneNumber">Phone Number:</label>
              <input
                type="tel"
                id="employeePhoneNumber"
                name="phoneNumber"
                required
                aria-required="true"
                aria-describedby="employee-phoneNumber-error"
              />
              <span
                class="error-message"
                id="employee-phoneNumber-error"
              ></span>
            </div>
            <div class="form-group">
              <label for="employeePassword">Password:</label>
              <input
                type="password"
                id="employeePassword"
                name="password"
                required
                aria-required="true"
                aria-describedby="employee-password-error"
              />
              <span class="error-message" id="employee-password-error"></span>
            </div>
            <div class="form-group">
              <button type="submit" class="btn btn-primary">Submit</button>
            </div>
          </form>
        </div>
        <div
          class="tab-pane fade"
          id="delete-employee"
          role="tabpanel"
          aria-labelledby="delete-employee-tab"
        >
          <div class="mb-3 mt-3">
            <input
              type="text"
              id="searchDeleteEmployeeInput"
              class="form-control"
              placeholder="Search employees by name to delete"
            />
          </div>
          <table class="table table-bordered table-striped">
            <thead>
              <tr>
                <th>ID</th>
                <th>Username</th>
                <th>Email</th>
                <th>Phone Number</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="deleteEmployeeTableBody">
              <!-- Employee rows will be dynamically added here -->
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <footer class="footer">
      <div class="container">
        <div class="row">
          <div class="col-md-4">
            <h5>Quick Links</h5>
            <ul class="list-unstyled">
              <li><a href="#">Home</a></li>
              <li><a href="#">Projects</a></li>
              <li><a href="#">Services</a></li>
              <li><a href="#">Homes for Sale</a></li>
              <li><a href="#">About Us</a></li>
              <li><a href="#">Contact</a></li>
            </ul>
          </div>
          <div class="col-md-4">
            <h5>Contact Us</h5>
            <p>
              123 Engineering Way,<br />
              City, State, 12345<br />
              Email: info@ironpillar.com<br />
              Phone: (123) 456-7890
            </p>
          </div>
          <div class="col-md-4">
            <h5>Follow Us</h5>
            <div class="social-icons">
              <a href="#" class="text-white me-2"
                ><i class="fab fa-facebook-f"></i
              ></a>
              <a href="#" class="text-white me-2"
                ><i class="fab fa-twitter"></i
              ></a>
              <a href="#" class="text-white"
                ><i class="fab fa-instagram"></i
              ></a>
            </div>
          </div>
        </div>
        <p class="mt-3">
          &copy; 2024 Iron Pillar Engineering and Construction. All rights
          reserved.
        </p>
      </div>
    </footer>

    <script>
      fetch("Header.html")
        .then((response) => response.text())
        .then((html) => {
          document.getElementById("header-container").innerHTML = html;
        })
        .catch((error) => console.error("Error fetching header:", error));

      const apiBaseURL = "/users";
      const employeeApiBaseURL = "/employees";

      document.addEventListener("DOMContentLoaded", () => {
        fetchUsers();
        fetchEmployees();
        document
          .getElementById("userForm")
          .addEventListener("submit", handleFormSubmit);
        document
          .getElementById("employeeForm")
          .addEventListener("submit", handleEmployeeFormSubmit);
        document
          .getElementById("searchInput")
          .addEventListener("input", handleSearch);
        document
          .getElementById("searchDeleteInput")
          .addEventListener("input", handleSearchDelete);
        document
          .getElementById("searchEmployeeInput")
          .addEventListener("input", handleEmployeeSearch);
        document
          .getElementById("searchDeleteEmployeeInput")
          .addEventListener("input", handleEmployeeSearchDelete);
      });

      function fetchUsers(query = "") {
        var modifiedQuery;
        if (query !== "") {
          modifiedQuery = `${apiBaseURL}/search?username=${query}`;
        } else {
          modifiedQuery = `${apiBaseURL}`;
        }

        fetchWithAuth(modifiedQuery)
          .then((response) => response.json())
          .then((users) => {
            const userTableBody = document.getElementById("userTableBody");
            const deleteUserTableBody = document.getElementById(
              "deleteUserTableBody"
            );
            userTableBody.innerHTML = "";
            deleteUserTableBody.innerHTML = "";
            users.forEach((user) => {
              const userRow = createUserRow(user);
              userTableBody.appendChild(userRow);
              deleteUserTableBody.appendChild(userRow.cloneNode(true));
            });
          })
          .catch((error) => console.error("Error fetching users:", error));
      }

      function createUserRow(user) {
        const row = document.createElement("tr");
        row.innerHTML = `
        <td>${user.id}</td>
        <td>${user.username}</td>
        <td>${user.email}</td>
        <td>${user.phoneNumber}</td>
        <td>
          <button class="btn btn-warning btn-sm m-2" onclick="editUser(${user.id})">Update</button>
          <button class="btn btn-danger btn-sm" onclick="deleteUser(${user.id})">Delete</button>
        </td>
      `;
        return row;
      }

      function handleFormSubmit(event) {
        event.preventDefault();
        const form = event.target;
        const userId = document.getElementById("userId").value;
        const url = userId ? `${apiBaseURL}/${userId}` : "/register";
        const method = userId ? "PUT" : "POST";
        const formData = new FormData(form);
        const data = Object.fromEntries(formData.entries());
        if (method === "POST") {
          data.password = formData.get("password");
        }

        fetch(url, {
          method: method,
          headers: {
            "Content-Type": "application/json",
            Authorization: `Bearer ${token}`,
          },
          body: JSON.stringify(data),
        })
          .then((response) => {
            if (!response.ok) {
              throw new Error("Network response was not ok");
            }
            fetchUsers();
            form.reset();
            document.getElementById("userId").value = "";
            alert("User saved successfully!");
          })
          .catch((error) => console.error("Error saving user:", error));
      }

      function editUser(userId) {
        fetchWithAuth(`${apiBaseURL}/${userId}`)
          .then((response) => response.json())
          .then((user) => {
            document.getElementById("userId").value = user.id;
            document.getElementById("username").value = user.username;
            document.getElementById("email").value = user.email;
            document.getElementById("phoneNumber").value = user.phoneNumber;
            document.getElementById("password").value = user.password;
            document.getElementById("create-user-tab").click();
          })
          .catch((error) => console.error("Error fetching user:", error));
      }

      function deleteUser(userId) {
        if (confirm("Are you sure you want to delete this user?")) {
          fetchWithAuth(`${apiBaseURL}/${userId}`, {
            method: "DELETE",
          })
            .then((response) => {
              if (!response.ok) {
                throw new Error("Network response was not ok");
              }
              fetchUsers();
              alert("User deleted successfully!");
            })
            .catch((error) => console.error("Error deleting user:", error));
        }
      }

      function handleSearch(event) {
        const query = event.target.value.trim();
        fetchUsers(query);
      }

      function handleSearchDelete(event) {
        const query = event.target.value;
        fetchUsers(query);
      }

      // Logic for CRUD Employees

      function fetchEmployees(query = "") {
        fetch(`${employeeApiBaseURL}?name=${query}`)
          .then((response) => response.json())
          .then((employees) => {
            const employeeTableBody =
              document.getElementById("employeeTableBody");
            const deleteEmployeeTableBody = document.getElementById(
              "deleteEmployeeTableBody"
            );
            employeeTableBody.innerHTML = "";
            deleteEmployeeTableBody.innerHTML = "";
            employees.forEach((employee) => {
              const employeeRow = createEmployeeRow(employee);
              employeeTableBody.appendChild(employeeRow);
              deleteEmployeeTableBody.appendChild(employeeRow.cloneNode(true));
            });
          })
          .catch((error) => console.error("Error fetching employees:", error));
      }

      function createEmployeeRow(employee) {
        const row = document.createElement("tr");
        row.innerHTML = `
        <td>${employee.id}</td>
        <td>${employee.username}</td>
        <td>${employee.email}</td>
        <td>${employee.phoneNumber}</td>
        <td>
          <button class="btn btn-warning btn-sm" onclick="editEmployee(${employee.id})">Edit</button>
          <button class="btn btn-danger btn-sm" onclick="deleteEmployee(${employee.id})">Delete</button>
        </td>
      `;
        return row;
      }

      function handleEmployeeFormSubmit(event) {
        event.preventDefault();
        const form = event.target;
        const employeeId = document.getElementById("employeeId").value;
        const url = employeeId
          ? `${employeeApiBaseURL}/${employeeId}`
          : employeeApiBaseURL;
        const method = employeeId ? "PUT" : "POST";
        const formData = new FormData(form);
        const data = Object.fromEntries(formData.entries());
        if (method === "POST") {
          data.password = formData.get("password");
        }

        fetch(url, {
          method: method,
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(data),
        })
          .then((response) => {
            if (!response.ok) {
              throw new Error("Network response was not ok");
            }
            fetchEmployees();
            form.reset();
            document.getElementById("employeeId").value = "";
            alert("Employee saved successfully!");
          })
          .catch((error) => console.error("Error saving employee:", error));
      }

      function editEmployee(employeeId) {
        fetch(`${employeeApiBaseURL}/${employeeId}`)
          .then((response) => response.json())
          .then((employee) => {
            document.getElementById("employeeId").value = employee.id;
            document.getElementById("employeeUsername").value =
              employee.username;
            document.getElementById("employeeEmail").value = employee.email;
            document.getElementById("employeePhoneNumber").value =
              employee.phoneNumber;
            document.getElementById("employeePassword").value =
              employee.password;
            document.getElementById("create-employee-tab").click();
          })
          .catch((error) => console.error("Error fetching employee:", error));
      }

      function deleteEmployee(employeeId) {
        if (confirm("Are you sure you want to delete this employee?")) {
          fetch(`${employeeApiBaseURL}/${employeeId}`, {
            method: "DELETE",
          })
            .then((response) => {
              if (!response.ok) {
                throw new Error("Network response was not ok");
              }
              fetchEmployees();
              alert("Employee deleted successfully!");
            })
            .catch((error) => console.error("Error deleting employee:", error));
        }
      }

      function handleEmployeeSearch(event) {
        const query = event.target.value;
        fetchEmployees(query);
      }

      function handleEmployeeSearchDelete(event) {
        const query = event.target.value;
        fetchEmployees(query);
      }

      function logout() {
        localStorage.removeItem("token");
        window.location.href = "/";
      }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js"></script>
  </body>
</html>
